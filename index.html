<!DOCTYPE html>
<html>
   <head>
      <script src="https://d3js.org/d3.v4.min.js"></script>
      <link rel="stylesheet" type="text/css" href="styles.css">

   </head>

   <body>
      <h3>Bechdel Test Visualisation</h3>
      <div id='container'>
            <svg></svg>
         </div>
      <script>

   const margin = 60;
   const width = 1000 - 2 * margin;
   const height = 600 - 2 * margin;

   const svg = d3.select('svg');

   d3.json("testFinalData.json", function(error, data) {
   
      const numberOfMovies = data[0].movies.length;

      const chart = svg.append('g')
        .attr('transform', `translate(${margin}, ${margin})`);


      const yScale = d3.scaleLinear()
         .range([height, 0])
         .domain([0, 50]);

      const xScale = d3.scaleBand()
         .range([0, width])
         .domain(data.map((s) => s.year))
         .padding(0.2)

      chart.append('g')
         .attr('transform', `translate(0, ${height})`)
         .call(d3.axisBottom(xScale));

      chart.append('g')
         .call(d3.axisLeft(yScale));

      chart.selectAll()
         .data(data)
         .enter()
      
         .each(function(d,i) {
            console.log(i); // prints the current index
            console.log(d); // prints the data at the current index
            let offset = 0;
            const dataPointHeight = height /(numberOfMovies);
            for (const movie of d.movies){
               console.log(movie);
               chart.append('rect')
               .attr('x', (s) => xScale(d.year))
               .attr('y', (s) => (height - 2 * margin) - offset)
               .attr('height', (s) => dataPointHeight)
               .attr('width', xScale.bandwidth())

               offset += dataPointHeight;
               console.log(offset);
            }
   
            })


   });
    </script>
   </body>
</html>